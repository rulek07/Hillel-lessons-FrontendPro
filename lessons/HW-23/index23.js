const catalog = [
    {
        name: "Шоссейные",
        products: [
            {
            name: "Giant TCR Advanced",
            description:
                "Велосипед Giant TCR Advanced SL Disc 0 DA - это улучшенная версия,\
                которая обеспечивает максимальную эффективность и отличные результаты в гонках.\
                Сочетание высокой жесткости вращения педалей к весу и формы аэрокамеры \
                позволяют этому байку обеспечивать лучшие возможности подъема, аэродинамическую \
                эффективность и спринтскую жесткость.\
                Цена: 7680$",
            },
            {
            name: "BIANCHI SPECIALISSIMA CV",
            description:
                "Bianchi Specialissima CV Ultegra Di2 – это топовый шоссейный велосипед от одного из\
                 авторитетнейших брендов велоиндустрии. Данная модель создана для профессиональных гонок\
                 и именно в них сможет полностью раскрыть как свой, так и гонщика потенциал.\
                 Собран байк на карбоновой фреймсете и таких же колесах, оснащен навесным оборудованием\
                 с электрическим приводом переключения передач и классическими ободными тормозами.\
                 Цена: 8900$",
            },
            {
            name: "ORBEA ORCA AERO",
            description:
                "Orbea Orca Aero M30 Team – профессиональный аэрошоссейный велосипед от испанского\
                 производителя. Этот байк создан для гонок и тренировок профессиональных спортсменов,\
                 а потому в нем стоит акцент на эффективности, скорости и жесткости. Собран байк\
                 на карбоновой фреймсете и вилсете Fulcrum, оснащен трансмиссией Shimano 105 и\
                 дисковой гидравликой.\
                 Цена: 7990$",
            },
       ],
    },
    {
        name: "Горные",
        products: [
            {
            name: "HAIBIKE XDURO ALLTRAIL",
            description:
                "Haibike XDURO AllTrail Flyon 5.0 – это электровелосипед на 27.5 колесах с\
                 кареточным двигателем. Байк произведен немецким премиальным брендом, который является\
                 первооткрывателем и мире электровелосипедов. Данная модель рассчитана на любиетлькую\
                 кросс-кантрийную эксплуатацию. Байк придется по вкусу как тем, кто просто хочет\
                 увеличить дальность своих покатушек, так и тем, кто тренируется. Ассистентный\
                 двигатель поможет реализовать и нарастить спортивный потенциал райдера.\
                 Цена: 4700$",
            },
            {
            name: "BOTTECCHIA E-FULL QUASAR",
            description:
                "Двухподвесный электровелосипед BOTTECCHIA E-FULL QUASAR 27.5 – это AllMountain байк,\
                 который будет превосходным тренажером как для профессиональных спортсменов, так\
                 и для любителей. Карбоновая рама и топовая амортизационная вилка Rock Shox PIKE,\
                 трансмиссия и тормоза Shimano XT, электропривод от Shimano – все это кроется под\
                 названием BOTTECCHIA E-FULL QUASAR.\
                 Цена: 5340$",
            },
            {
            name: "GIANT GLORY 1",
            description:
                "Giant Glory 1 27,5 – легендарный байк для стремительных спусков от всемирно\
                 известного бренда! В нем собраны все передовые наработки и опыт компании для\
                 достижения максимального контроля велосипеда на трассе и обеспечения максимальной\
                 прочности и надежности.\
                 Цена: 3999$",
            },
        ],
    },
    {
        name: "Городские",
        products: [
            {
            name: "MOMENTUM TRANSEND E+ GTS 25",
            description:
                "Электровелосипед Momentum Transend E GTS 25 - это инновационный велосипед,\
                 оснащенный двигателем SyncDrive Life, который использует технологию Smart Assist.\
                 Система состоит из шести датчиков, которые вычисляют крутящий момент, частоту\
                 педалирования, наклон и скорость. Благодаря этому электровелосипед предоставляет плавную\
                 и мощную помощь при педалировании, что делает его идеальным выбором для любителей быстрой\
                 езды. С таким велосипедом Вы можете мчаться по дороге на максимальной скорости, чувствуя\
                 мощный поток ветра в лицо.\
                 Цена: 2450$",
            },
            {
            name: "GRAZIELLA GOLD",
            description:
                "Graziella празднует 50-ти летие. Полвека отделяет нас от рождения легенды Graziella.\
                 В честь 50-летия, компания подготовила специальную ограниченную версию своего велосипеда\
                  — Graziella Gold Edition. Жемчужина среди велосипедов, модель у которой рама и вилка\
                  полностью покрыты 24K золотом, а детали инкрустированы деревом. Graziella подчеркивает\
                  ювелирное внимание к деталям и постоянным техническим инновациям,\
                  не забывая свои исторические корни.\
                  Цена: 3750$",
            },
            {
            name: "MANDO FOOTLOOSE G2",
            description:
                "Уникальный городской электробайк Mando Footloose, спроектирован знаменитым английским\
                 дизайнером Марком Сандерсом. Footloose - новая модель, которая позволит вам выразить ваш\
                 стиль при помощи расширенной палитры цветов. Индивидуальные средства передвижения никогда\
                 не были столь выразительны. Mando Footloose не использует цепей, которые стали символом\
                 велосипедов, заменив их Серийной Гибридной Системой (Series Hybrid System), что позволяет\
                 передвигаться на данном транспортном средстве также удобно, как и на автомобиле.\
                 Цена: 4190$",
            },
        ],
    },
];

let titles = {
    catalogTitle: "Категории велосипедов:",
    productTitle: "Список велосипедов:",
    descriptionTitle: "Информация о товаре:",
    buyButtonTitle: "Купить",
}
const mainBox = document.getElementById("container");

const catalogBox = mainBox.appendChild(document.createElement("section"));
      catalogBox.id = 'catalog'
const catalogBoxTitle = catalogBox.appendChild(document.createElement("H3"));
      catalogBoxTitle.textContent = titles.catalogTitle;
const catalogBoxList = catalogBox.appendChild(document.createElement("ul"));
      catalogBoxList.id = 'catalog_list'

const productBox = mainBox.appendChild(document.createElement("section"));
      productBox.id = 'product'
const productBoxTitle = productBox.appendChild(document.createElement("H3"));
      productBoxTitle.textContent = titles.productTitle;
const productBoxList = productBox.appendChild(document.createElement("ul"));
      productBoxList.id = 'product_list'

const descriptionBox = mainBox.appendChild(document.createElement("section"));
      descriptionBox.id = 'result'
const descriptionBoxTitle = descriptionBox.appendChild(document.createElement("H3"));
      descriptionBoxTitle.textContent = titles.descriptionTitle;
const descriptionBoxResult = descriptionBox.appendChild(document.createElement("div"));

$(document).ready(function () {
    $("#usernumber").inputmask("+38 (099) 999-99-99");
});

const cleaner = () => {
    const buyButton = document.getElementById('buyButton')
    buyButton && buyButton.remove()
    productBoxTitle.textContent = titles.productTitle;
    productBoxList.textContent = ''
    descriptionBoxTitle.textContent = titles.descriptionTitle;
    descriptionBoxResult.textContent = ''
};

catalog.forEach((category) => { 
    const catalogElement = catalog_list.appendChild(document.createElement("li"));
    catalogElement.textContent = category.name;
    catalogElement.addEventListener("click", showProducts);
});

let selectedProduct;
function showProducts(item){
    let currentDep = catalog.find((category) => category.name === item.target.innerHTML);
    cleaner();
    currentDep.products.forEach((product) => {  
        const productItem = productBoxList.appendChild(document.createElement("li"));
        productItem.textContent = product.name;
        productItem.addEventListener("click", () => {
            selectedProduct = product.name
            showDescription(product)
        });
    })
};

function showDescription(product) {
    descriptionBoxResult.textContent = product.description;
    createBuyButton();   
};

function createBuyButton (){
    if(!document.getElementById('buyButton')){
        const buyButton = descriptionBox.appendChild(document.createElement("button"));
        buyButton.id = 'buyButton'
        buyButton.textContent = titles.buyButtonTitle;
        buyButton.addEventListener("click", function () {
            document.getElementById('popup').classList.add('active')
        });
    }       
};

form.addEventListener('submit', getFormValue)

function getFormValue(event) {
    event.preventDefault();
    const formData = {
        userName: form.userName.value,
        usersNumber: form.usersNumber.value,
        usersCity: form.usersCity.value,
        postNumber: form.postNumber.value,
        paymentMethod: form.paymentMethod.value,
        quantity: form.quantity.value,
        usersComment: form.usersComment.value
    }
    const new_window = window.open();
          new_window.document.write(`<h3>Купленный товар: ${selectedProduct}.</h3>`);

    for(key in formData){
        new_window.document.write(`<p> - <strong>${key}</strong>: ${formData[key]}</p>`)
    };

    form.reset();
    cleaner();   
    document.getElementById('popup').classList.remove('active');
}